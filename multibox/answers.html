<!DOCTYPE html> 
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Antworten speichern und drucken</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 10px;
            box-sizing: border-box;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            resize: vertical;
            padding: 10px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
            margin-top: 10px;
            color: white;
            border: none;
            border-radius: 4px;
        }
        #printBtn {
            background-color: #4CAF50; /* Green */
        }
        #saveBtn {
            background-color: #008CBA; /* Blue */
        }
        #clearBtn {
            background-color: #f44336; /* Red */
        }
        .info-text {
            font-size: 12px;
            color: #555;
            margin-bottom: 10px;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #printContent, #printContent * {
                visibility: visible;
            }
            #printContent {
                position: absolute;
                left: 0;
                top: 0;
            }
            textarea {
                display: none;
            }
            #answerText {
                display: block;
                white-space: pre-wrap; /* Preserves line breaks */
                font-size: 14px;
                padding: 10px;
                border: 1px solid #ccc;
                box-sizing: border-box;
                width: 100%;
                height: auto;
            }
            #printContent h3 {
                margin-bottom: 10px;
            }
            button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="printContent">
        <h3>Deine Antwort:</h3>
        <p id="assignmentInfo"></p>
        <textarea id="answerBox" placeholder="Gib hier deine Antworten ein..."></textarea>
        <div id="answerText" style="display: none;"></div>
    </div>
    
    <p class="info-text">
        Mit "Antwort zwischenspeichern" werden deine Antworten auf einer Seite gespeichert, die am Ende der Einheit angezeigt wird.
    </p>
    <button id="printBtn" onclick="printAnswer()">Antwort drucken / als PDF speichern</button>
    <button id="saveBtn" onclick="saveToLocal()">Antwort zwischenspeichern</button>
    <button id="clearBtn" onclick="clearLocalStorage()">Alle Antworten löschen</button>
    
    <script>
        // Function to get query parameter by name
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const assignmentId = getQueryParam('assignmentId') || 'defaultAssignment';
        const assignmentInfo = document.getElementById('assignmentInfo');

        // Extract the numerical part of the assignmentId
        const assignmentNumberMatch = assignmentId.match(/\d+/);
        const assignmentNumber = assignmentNumberMatch ? assignmentNumberMatch[0] : '';
        assignmentInfo.textContent = assignmentNumber ? `Auftrag ${assignmentNumber}` : 'Auftrag';

        const textarea = document.getElementById('answerBox');
        const answerText = document.getElementById('answerText');

        // Load saved text from localStorage
        const savedText = localStorage.getItem(assignmentId);
        if (savedText) {
            textarea.value = savedText;
            console.log(`Loaded saved text for ${assignmentId}`);
        } else {
            console.log(`No saved text found for ${assignmentId}`);
        }

        // Function to print the answer
        function printAnswer() {
            const text = textarea.value;
            if (text.trim() === "") {
                alert("Das Antwortfeld ist leer. Bitte geben Sie eine Antwort ein.");
                console.log("Print attempted with empty text field");
                return;
            }
            // Set the text for printing
            answerText.textContent = text;
            console.log(`Print initiated for ${assignmentId}`);
            window.print();
            // Clear the text after printing to avoid duplication if print is canceled
            answerText.textContent = '';
        }

        // Function to save the answer to localStorage
        function saveToLocal() {
            const text = textarea.value;
            if (text.trim() === "") {
                alert("Das Antwortfeld ist leer. Bitte geben Sie eine Antwort ein.");
                console.log("Save attempted with empty text field");
                return;
            }
            localStorage.setItem(assignmentId, text);
            alert("Antwort zwischengespeichert.");
            console.log(`Saved text for ${assignmentId}`);
        }

        // Function to clear all saved answers from localStorage
        function clearLocalStorage() {
            if (confirm("Sind Sie sicher, dass Sie alle gespeicherten Antworten löschen möchten?")) {
                localStorage.clear();
                textarea.value = '';
                alert("Alle gespeicherten Antworten wurden gelöscht.");
                console.log("All localStorage items cleared");
            }
        }

        // Optional: Log initial localStorage state to console for debugging
        console.log("Initial localStorage state:");
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            console.log(`${key}: ${localStorage.getItem(key)}`);
        }
    </script>
</body>
</html>
